# 智能评论位置跟踪系统测试指南

## 简介
本指南用于测试智能评论位置跟踪系统的功能，该系统能够在代码行被删除或移动时自动重新定位评论。

## 测试准备

### 1. 安装扩展
- 按 `F5` 启动开发模式，或
- 安装最新的 `code-review-notes-0.1.0.vsix` 文件

### 2. 打开测试文件
打开 `test-position-tracking.js` 文件进行测试

## 测试场景

### 场景1: 基本评论添加和位置追踪

1. **添加评论**
   - 选择第8行的 `console.log("This is a basic function");`
   - 右键选择"添加代码评论"或按 `Ctrl+Shift+C`
   - 输入评论："这行代码需要错误处理"
   - 验证评论正确显示和高亮

2. **验证锚点创建**
   - 检查评论是否包含上下文信息
   - 评论应该锚定在正确的代码行

### 场景2: 代码修改时的位置追踪

1. **在评论前插入代码**
   - 在第7行（评论所在行的前面）插入新行：
     ```javascript
     console.log("Added before the comment");
     ```
   - 保存文件
   - 验证评论是否自动移动到新的正确位置

2. **删除评论前的代码**
   - 删除刚才添加的行
   - 验证评论是否回到原始位置

### 场景3: 评论目标代码被删除

1. **删除被评论的代码行**
   - 删除包含评论的整行代码
   - 验证系统如何处理"已删除"状态的评论

2. **检查通知系统**
   - 查看是否收到位置变化的通知
   - 检查状态消息是否准确

### 场景4: 复杂代码重构

1. **添加多个评论**
   - 在第15行添加评论："此参数需要验证"
   - 在第20行添加评论："性能优化点"
   - 在第32行添加评论："数据结构可优化"

2. **进行代码重构**
   - 移动函数位置
   - 重新组织代码结构
   - 验证所有评论是否正确跟踪

### 场景5: 模糊匹配测试

1. **轻微修改被评论的代码**
   - 将 `console.log("This is a basic function");` 改为 `console.log("This is a modified function");`
   - 验证评论是否仍能正确定位

2. **测试置信度系统**
   - 查看评论的定位置信度
   - 验证低置信度时的警告机制

## 验证检查清单

### ✅ 基本功能
- [ ] 评论正确添加并显示锚点信息
- [ ] 代码修改后评论自动重新定位
- [ ] 位置变化通知正确显示
- [ ] 评论状态正确更新（valid/moved/deleted）

### ✅ 智能追踪
- [ ] 上下文匹配工作正常
- [ ] 模糊匹配功能有效
- [ ] 置信度计算准确
- [ ] 冲突检测正常工作

### ✅ 用户体验
- [ ] 通知消息清晰明确
- [ ] 手动重新定位功能可用
- [ ] 性能在大文件中可接受
- [ ] 错误处理优雅

### ✅ 兼容性
- [ ] 旧版评论自动迁移
- [ ] 树视图正确显示位置信息
- [ ] 悬停提示包含锚点状态
- [ ] 导航功能正常工作

## 预期结果

### 成功指标
1. **智能重定位**: 评论在代码修改后自动找到新位置
2. **状态通知**: 用户及时收到位置变化的反馈
3. **置信度评估**: 系统能评估重定位的可靠性
4. **优雅降级**: 无法重定位时提供合理的回退机制

### 性能基准
- 大文件（1000+ 行）中的响应时间 < 2秒
- 多评论（50+ 个）的更新时间 < 1秒
- 内存使用合理，无明显泄漏

## 故障排除

### 常见问题
1. **评论丢失**: 检查是否启用了智能锚点系统
2. **位置错误**: 验证代码上下文是否足够独特
3. **性能问题**: 检查是否有过多的实时更新
4. **通知过多**: 调整通知阈值设置

### 调试信息
- 查看开发者控制台的详细日志
- 检查评论的锚点状态信息
- 验证位置追踪器的配置

## 高级测试场景

### 大规模重构测试
1. 添加20+评论到不同位置
2. 进行大规模代码重构
3. 验证批量重定位性能

### 并发修改测试
1. 多人同时修改带评论的文件
2. 测试冲突解决机制
3. 验证数据一致性

### 边界情况测试
1. 空文件中的评论
2. 非常长的代码行
3. 特殊字符和编码

---

**测试完成后，请记录发现的问题和改进建议！**
