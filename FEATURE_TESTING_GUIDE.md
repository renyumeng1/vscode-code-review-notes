# 新功能测试指南

## 概述
本指南描述如何测试新实现的三个核心功能：
1. **实时监控被评论代码的所有变动**（后台静默运行）
2. **删除评论按钮**
3. **选中代码行时显示透明"Add Comment"小框**（类似Cursor的UI体验）

## 功能1: 实时监控被评论代码的变动

### 测试目标
验证系统能够静默监控评论位置的变化，并在后台自动更新位置信息。

### 测试步骤
1. **准备工作**
   - 打开 `test-position-tracking-demo.js` 文件
   - 确保文件中有一些评论（如果没有，先添加几个评论）

2. **测试内容变化监控**
   - 在已评论的代码行之前插入新行
   - 在已评论的代码行之后插入新行
   - 修改已评论的代码行内容
   - 删除已评论的代码行附近的其他行

3. **测试保存监控**
   - 修改文件后保存（Ctrl+S）
   - 检查评论位置是否正确更新

4. **测试编辑器切换监控**
   - 打开多个文件，在不同文件间切换
   - 验证每个文件的评论监控都正常工作

### 验证方法
- 通过VS Code输出面板查看监控日志
- 使用 `Ctrl+Shift+P` → "Show Comments in Panel" 验证评论位置正确性
- 观察评论标记是否跟随代码位置移动

## 功能2: 删除评论按钮

### 测试目标
验证用户可以通过多种方式删除评论。

### 测试步骤
1. **通过命令面板删除**
   - 选中有评论的代码行
   - 按 `Ctrl+Shift+P` 打开命令面板
   - 搜索 "Delete Comment" 命令
   - 执行删除操作

2. **通过右键菜单删除**
   - 右键点击有评论的代码行
   - 在上下文菜单中找到删除评论选项
   - 点击删除

3. **批量删除测试**
   - 在同一文件中创建多个评论
   - 测试删除单个评论
   - 测试删除文件所有评论的功能

### 验证方法
- 确认评论从界面中消失
- 验证评论数据从存储中移除
- 检查相关的装饰器和标记是否清理干净

## 功能3: 内联"Add Comment"UI

### 测试目标
验证选中代码行时显示类似Cursor的透明"Add Comment"小框。

### 测试步骤
1. **基本显示测试**
   - 在代码编辑器中选中任意代码行
   - 观察是否出现"Add Comment"按钮或状态栏项
   - 验证UI元素的外观和位置

2. **交互测试**
   - 点击"Add Comment"按钮
   - 验证是否打开评论输入界面
   - 测试输入评论文本并保存

3. **自动隐藏测试**
   - 选中代码行后等待3秒
   - 验证"Add Comment"UI是否自动隐藏
   - 移动到其他行，验证UI是否更新

4. **已有评论行测试**
   - 选中已有评论的代码行
   - 验证是否显示删除评论按钮而不是添加按钮

### 验证方法
- 观察UI元素的显示时机和位置
- 测试点击交互的响应性
- 验证UI的自动清理机制

## 全功能集成测试

### 综合测试场景
1. **完整工作流测试**
   - 打开一个新文件
   - 选中代码行，使用内联UI添加评论
   - 修改代码，观察实时监控效果
   - 使用删除功能移除评论

2. **多文件协作测试**
   - 打开多个文件，每个文件添加评论
   - 在文件间切换，验证监控和UI都正常工作
   - 批量操作测试

3. **性能测试**
   - 创建较大的文件（1000+ 行）
   - 添加多个评论（10+ 个）
   - 进行大量编辑操作，观察系统响应性

## 预期结果

### 成功指标
- ✅ 实时监控无需用户干预，静默运行
- ✅ 评论位置在代码变更后自动更新
- ✅ 删除功能正常工作，无残留数据
- ✅ 内联UI体验流畅，类似专业代码审查工具
- ✅ 所有功能协同工作，无冲突

### 故障排除
如果遇到问题：
1. 检查VS Code开发者控制台的错误信息
2. 查看VS Code输出面板的日志
3. 重启VS Code重新加载扩展
4. 检查 `out/` 目录是否包含编译后的文件

## 测试数据文件
- `test-position-tracking-demo.js` - 主要测试文件
- 可以创建额外的测试文件来验证跨文件功能

## 注意事项
- 测试时注意观察性能，监控不应影响编辑体验
- 验证内存使用，确保长时间使用不会造成内存泄漏
- 测试边界情况，如空文件、超长行等
